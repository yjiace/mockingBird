<!DOCTYPE html>
<html lang="zh-CN" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>API 文档 | Mock Flow API - 详细的接口文档和使用指南</title>
    <meta name="title" content="API 文档 | Mock Flow API - 详细的接口文档和使用指南">
    <meta name="description" content="Mock Flow API 完整文档 - 包含所有API接口的详细说明、参数配置、示例代码和使用指南。支持HTTP、SSE、WebSocket等多种协议。">
    <meta name="keywords" content="API文档, 接口文档, Mock API, 开发文档, API接口说明, 接口参数, 示例代码, HTTP API, SSE API, WebSocket API">
    <meta name="author" content="Mock Flow API">
    <meta name="robots" content="index, follow">
    <meta name="language" content="zh-CN">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://mockflow-api.com/docs">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mockflow-api.com/docs">
    <meta property="og:title" content="API 文档 | Mock Flow API">
    <meta property="og:description" content="Mock Flow API 完整文档 - 包含所有API接口的详细说明、参数配置、示例代码和使用指南。">
    <meta property="og:image" content="https://mockflow-api.com/img/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Mock Flow API">
    <meta property="og:locale" content="zh_CN">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mockflow-api.com/docs">
    <meta property="twitter:title" content="API 文档 | Mock Flow API">
    <meta property="twitter:description" content="Mock Flow API 完整文档 - 包含所有API接口的详细说明、参数配置、示例代码和使用指南。">
    <meta property="twitter:image" content="https://mockflow-api.com/img/logo.png">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#D33A82">
    <meta name="msapplication-TileColor" content="#D33A82">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Favicon -->
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" sizes="32x32" />
    <link rel="apple-touch-icon" href="img/logo.png">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Configure highlight.js languages -->
    <script>
        // 确保 highlight.js 支持所有需要的语言
        hljs.configure({
            ignoreUnescapedHTML: true
        });
        
        // 手动注册语言（如果需要）
        if (hljs.getLanguage('javascript') === undefined) {
            console.warn('JavaScript language not found in highlight.js');
        }
        if (hljs.getLanguage('java') === undefined) {
            console.warn('Java language not found in highlight.js');
        }
        if (hljs.getLanguage('go') === undefined) {
            console.warn('Go language not found in highlight.js');
        }
        if (hljs.getLanguage('php') === undefined) {
            console.warn('PHP language not found in highlight.js');
        }
        if (hljs.getLanguage('python') === undefined) {
            console.warn('Python language not found in highlight.js');
        }
        if (hljs.getLanguage('bash') === undefined) {
            console.warn('Bash language not found in highlight.js');
        }
    </script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "Mock Flow API 文档",
        "description": "Mock Flow API 完整文档 - 包含所有API接口的详细说明、参数配置、示例代码和使用指南。",
        "author": {
            "@type": "Organization",
            "name": "Mock Flow API Team"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Mock Flow API",
            "logo": {
                "@type": "ImageObject",
                "url": "https://mockflow-api.com/img/logo.png"
            }
        },
        "datePublished": "2024-01-01",
        "dateModified": "2024-01-01",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://mockflow-api.com/docs"
        },
        "about": {
            "@type": "Thing",
            "name": "API Documentation"
        },
        "audience": {
            "@type": "Audience",
            "audienceType": "Developers"
        }
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "API 文档",
        "description": "Mock Flow API 完整文档和使用指南",
        "url": "https://mockflow-api.com/docs",
        "isPartOf": {
            "@type": "WebSite",
            "name": "Mock Flow API",
            "url": "https://mockflow-api.com/"
        },
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "首页",
                    "item": "https://mockflow-api.com/"
                },
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "API 文档",
                    "item": "https://mockflow-api.com/docs"
                }
            ]
        }
    }
    </script>
    <style>
        /* CSS Variables - Dark Theme */
        :root {
            --background: 0 0% 7%;
            --foreground: 0 0% 98%;
            --card: 0 0% 12%;
            --card-foreground: 0 0% 98%;
            --popover: 0 0% 10%;
            --popover-foreground: 0 0% 98%;
            --primary: 330 65% 50%;
            --primary-foreground: 0 0% 98%;
            --secondary: 195 60% 45%;
            --secondary-foreground: 0 0% 98%;
            --muted: 0 0% 15%;
            --muted-foreground: 0 0% 65%;
            --accent: 195 65% 50%;
            --accent-foreground: 0 0% 98%;
            --destructive: 0 70% 50%;
            --destructive-foreground: 0 0% 98%;
            --border: 0 0% 20%;
            --input: 0 0% 14%;
            --ring: 330 65% 55%;
            --radius: 0.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Main Layout */
        .main-container {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 2rem;
            padding: 2rem;
            width: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            flex-shrink: 0;
            background: hsl(var(--card));
            border-radius: var(--radius);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
            border: 1px solid hsl(var(--border));
        }

        .sidebar h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: hsl(var(--foreground));
        }

        .api-list {
            list-style: none;
        }

        .api-item {
            margin-bottom: 0.5rem;
        }

        .api-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: calc(var(--radius) - 2px);
            text-decoration: none;
            color: hsl(var(--muted-foreground));
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .api-link:hover {
            background: hsla(var(--accent), 0.1);
            color: hsl(var(--foreground));
        }

        .api-link.active {
            background: hsla(var(--primary), 0.2);
            color: hsl(var(--primary));
        }

        .method-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .method-get {
            background: hsla(120, 70%, 50%, 0.2);
            color: hsl(120, 70%, 60%);
        }

        .method-post {
            background: hsla(210, 70%, 50%, 0.2);
            color: hsl(210, 70%, 60%);
        }

        .method-put {
            background: hsla(45, 70%, 50%, 0.2);
            color: hsl(45, 70%, 60%);
        }

        .method-delete {
            background: hsla(0, 70%, 50%, 0.2);
            color: hsl(0, 70%, 60%);
        }

        /* Content Area */
        .content {
            flex: 1;
            background: hsl(var(--card));
            border-radius: var(--radius);
            /*padding: 2rem;*/
            border: 1px solid hsl(var(--border));
        }

        .api-doc {
            display: none;
        }

        .api-doc.active {
            display: block;
        }

        .api-doc h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .api-path {
            background: hsl(var(--muted));
            color: hsl(var(--foreground));
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .api-summary {
            color: hsl(var(--foreground));
            font-weight: 600;
        }

        .api-doc .description {
            color: hsl(var(--muted-foreground));
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: hsl(var(--foreground));
        }

        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            background: hsl(var(--muted));
            border-radius: var(--radius);
            overflow: hidden;
        }

        .param-table th,
        .param-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid hsl(var(--border));
        }

        .param-table th {
            background: hsla(var(--primary), 0.1);
            font-weight: 600;
            color: hsl(var(--foreground));
        }

        .param-table td {
            color: hsl(var(--muted-foreground));
        }

        .param-table tr:last-child td {
            border-bottom: none;
        }

        .code-block {
            background: hsl(var(--muted));
            border-radius: var(--radius);
            margin: 1rem 0;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .tabs {
            margin-bottom: 1rem;
        }

        .tab-list {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid hsl(var(--border));
        }

        .tab-button {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: hsl(var(--muted-foreground));
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-button:hover {
            color: hsl(var(--foreground));
        }

        .tab-button.active {
            color: hsl(var(--primary));
            border-bottom-color: hsl(var(--primary));
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .status-code {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .status-200 {
            background: hsla(120, 70%, 50%, 0.2);
            color: hsl(120, 70%, 60%);
        }

        .status-400 {
            background: hsla(45, 70%, 50%, 0.2);
            color: hsl(45, 70%, 60%);
        }

        .status-500 {
            background: hsla(0, 70%, 50%, 0.2);
            color: hsl(0, 70%, 60%);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
                position: static;
            }

            .nav {
                display: none;
            }
        }

        /* Framework Dropdown Styles */
        .framework-dropdown {
            margin-bottom: 1rem;
        }

        .framework-dropdown select {
            background: hsl(var(--input));
            border: 1px solid hsl(var(--border));
            color: hsl(var(--foreground));
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .framework-dropdown select:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }

        .framework-dropdown select:hover {
            border-color: hsl(var(--ring));
        }

        .framework-dropdown label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: hsl(var(--muted-foreground));
            margin-bottom: 0.5rem;
        }

        /* Code Block Container */
        .code-container {
            position: relative;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            /*padding: 1rem 0;*/
        }

        .tab-content.active {
            display: block;
        }

        /* Tab Buttons */
        .tab-list {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid hsl(var(--border));
            padding-bottom: 0.5rem;
        }

        .tab-button {
            background: none;
            border: none;
            color: hsl(var(--muted-foreground));
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .tab-button:hover {
            background: hsl(var(--muted));
            color: hsl(var(--foreground));
        }

        .tab-button.active {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        /* Section */
        .section {
            margin-bottom: 2rem;
        }

        .section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: hsl(var(--foreground));
        }

        .status-code {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .status-200 { background: #22c55e; color: white; }
        .status-404 { background: #ef4444; color: white; }
        .status-500 { background: #f59e0b; color: white; }

        /* Parameter Table */
        .param-table {
            width: 100%;
            border-collapse: collapse;
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            overflow: hidden;
        }

        .param-table th,
        .param-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid hsl(var(--border));
        }

        .param-table th {
            background: hsl(var(--muted));
            font-weight: 600;
            color: hsl(var(--foreground));
        }

        .param-table tr:last-child td {
            border-bottom: none;
        }

        .param-table code {
            background: hsl(var(--muted));
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }

        /* API Documentation */
        .api-doc {
            display: none;
            background: hsl(var(--card));
            /*border: 1px solid hsl(var(--border));*/
            border-radius: var(--radius);
            padding: 2rem 1.5rem 0rem 1.5rem;
            margin-bottom: 2rem;
        }

        .api-doc.active {
            display: block;
        }

        .api-doc h2 {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .method-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }

        .method-get { background: #22c55e; }
        .method-post { background: #3b82f6; }
        .method-put { background: #f59e0b; }
        .method-patch { background: #8b5cf6; }
        .method-delete { background: #ef4444; }

        .api-path {
            background: hsl(var(--muted));
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
        }

        .api-summary {
            color: hsl(var(--muted-foreground));
            font-weight: 400;
        }

        .description {
            color: hsl(var(--muted-foreground));
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
                position: static;
                margin-bottom: 2rem;
            }

            .api-doc h2 {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .tab-list {
                flex-wrap: wrap;
            }

            .param-table {
                font-size: 0.875rem;
            }

            .param-table th,
            .param-table td {
                padding: 0.5rem;
            }
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 2rem;
            color: hsl(var(--muted-foreground));
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid hsl(var(--border));
            border-radius: 50%;
            border-top-color: hsl(var(--primary));
            animation: spin 1s ease-in-out infinite;
            margin-left: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error State */
        .error {
            text-align: center;
            padding: 2rem;
            color: hsl(var(--destructive));
            background: hsl(var(--destructive) / 0.1);
            border: 1px solid hsl(var(--destructive));
            border-radius: var(--radius);
        }

        /* Copy Button */
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: hsl(var(--muted));
            border: 1px solid hsl(var(--border));
            color: hsl(var(--muted-foreground));
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-button:hover {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .copy-button.copied {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        /* Accordion triangle right */
        .response-accordion summary {
            position: relative;
            padding-right: 2em;
            list-style: none;
        }
        .response-accordion summary::-webkit-details-marker,
        .response-accordion summary::marker {
            display: none;
            content: '';
        }
        .response-accordion summary .accordion-arrow {
            position: absolute;
            right: 0.5em;
            top: 50%;
            transform: translateY(-50%) rotate(0deg);
            transition: transform 0.2s;
            width: 1.1em;
            height: 1.1em;
            display: inline-block;
        }
        .response-status-accordion[open] summary .accordion-arrow {
            transform: translateY(-50%) rotate(90deg);
        }
    </style>
</head>

<body>
    <!-- Header will be loaded here -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="API接口导航">
            <h3>API 接口</h3>
            <nav>
                <ul class="api-list" id="apiList" role="list">
                    <!-- API list will be populated by JavaScript -->
                </ul>
            </nav>
        </aside>

        <!-- Content -->
        <main class="content" role="main" aria-labelledby="api-docs-title">
            <div id="apiDocs" role="region" aria-label="API文档内容">
                <!-- API documentation will be populated by JavaScript -->
            </div>
        </main>
    </div>

    <!-- Footer will be loaded here -->
    <div id="footer-placeholder"></div>

    <!-- Load Components -->
    <script src="components/header.js"></script>
    <script src="components/footer.js"></script>
    <script>
        // Load header and footer
        document.addEventListener('DOMContentLoaded', function() {
            // Load header
            document.getElementById('header-placeholder').innerHTML = createHeader('docs');
            
            // Load footer
            document.getElementById('footer-placeholder').innerHTML = createFooter();
            
            // Add header styles
            const headerStyle = document.createElement('style');
            headerStyle.textContent = headerStyles;
            document.head.appendChild(headerStyle);
            
            // Add footer styles
            const footerStyle = document.createElement('style');
            footerStyle.textContent = footerStyles;
            document.head.appendChild(footerStyle);
        });

        // 全局变量存储API配置
        let apiDefinitions = [];
        let availableFiles = {};
        let protocolInfo = {};
        let tableStructures = {};
        let methodColors = {};

        // 从JSON配置文件加载数据
        async function loadApiConfig() {
            try {
                const response = await fetch('api-config.json');
                const config = await response.json();
                
                apiDefinitions = config.apiDefinitions;
                availableFiles = config.availableFiles || {};
                protocolInfo = config.protocolInfo || {};
                tableStructures = config.tableStructures || {};
                methodColors = config.methodColors || {};
                
                // 加载配置后初始化文档
                initDocs();
            } catch (error) {
                console.error('加载API配置失败:', error);
                // 如果加载失败，显示错误信息
                document.getElementById('apiDocs').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h2>配置加载失败</h2>
                        <p>无法加载API配置文件，请检查网络连接或联系管理员。</p>
                        <p>错误信息: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Initialize the documentation
        function initDocs() {
            const apiList = document.getElementById('apiList');
            const apiDocs = document.getElementById('apiDocs');

            // 清空现有内容
            apiList.innerHTML = '';
            apiDocs.innerHTML = '';

            // Populate sidebar
            apiDefinitions.forEach(api => {
                const listItem = document.createElement('li');
                listItem.className = 'api-item';
                listItem.innerHTML = `
                    <div class="api-link" data-api-id="${api.id}">
                        <span class="method-badge method-${api.method.toLowerCase()}">${api.method}</span>
                        <span>${api.path}</span>
                    </div>
                `;
                apiList.appendChild(listItem);

                // Create documentation content
                const docElement = createApiDoc(api);
                apiDocs.appendChild(docElement);
            });

            // Add click handlers for API navigation
            document.querySelectorAll('.api-link').forEach(link => {
                link.addEventListener('click', () => {
                    const apiId = link.dataset.apiId;
                    showApiDoc(apiId);
                });
            });

            // Show first API by default
            if (apiDefinitions.length > 0) {
                showApiDoc(apiDefinitions[0].id);
            }

            // Handle URL hash
            if (window.location.hash) {
                const apiId = window.location.hash.substring(1);
                showApiDoc(apiId);
            }
        }

        function createApiDoc(api) {
            const doc = document.createElement('div');
            doc.className = 'api-doc';
            doc.id = `doc-${api.id}`;

            let parametersHtml = '';
            if (api.parameters) {
                if (api.parameters.path) {
                    parametersHtml += createParameterTable('路径参数', api.parameters.path);
                }
                if (api.parameters.query) {
                    parametersHtml += createParameterTable('查询参数', api.parameters.query);
                }
                if (api.parameters.headers) {
                    parametersHtml += createParameterTable('请求头', api.parameters.headers);
                }
                if (api.parameters.body) {
                    parametersHtml += createParameterTable('请求体参数', api.parameters.body);
                }
            }

            let responsesHtml = '';
            if (api.responses) {
                responsesHtml = '<div class="section"><h3>响应示例</h3>';
                const protocols = Object.keys(api.responses);
                if (protocols.length > 1) {
                    // 协议Tab栏
                    responsesHtml += `<div class="tabs" data-api-id="${api.id}" data-tab-type="protocol">`;
                    responsesHtml += '<div class="tab-list" style="margin-top: 1rem; border-bottom: none;margin-bottom: 2rem;">';
                    protocols.forEach((protocol, pIndex) => {
                        responsesHtml += `<button class="tab-button ${pIndex === 0 ? 'active' : ''}" data-tab="protocol-${api.id}-${protocol}">${protocol.toUpperCase()}</button>`;
                    });
                    responsesHtml += '</div>';
                    protocols.forEach((protocol, pIndex) => {
                        responsesHtml += `<div class="tab-content ${pIndex === 0 ? 'active' : ''}" data-tab="protocol-${api.id}-${protocol}">`;
                        // 协议下所有状态码的折叠列表
                        const statusEntries = Object.entries(api.responses[protocol]);
                        responsesHtml += '<div class="accordion response-accordion">';
                        statusEntries.forEach(([status, details], idx) => {
                            const defaultOpen = idx === 0 ? 'open' : '';
                            responsesHtml += `
                                <details class="response-status-accordion" ${defaultOpen}>
                                    <summary>
                                        <span class="status-code status-${status}" style="margin-right:8px;">${status}</span>
                                        <span>${details.description || ''}</span>
                                        <span class="accordion-arrow"><svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 3l6 5-6 5" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                                    </summary>
                                    <div class="response-example">
                                        <div class="code-block">
                                            <pre><code class="language-json">${details.example}</code></pre>
                                        </div>
                                    </div>
                                </details>
                            `;
                        });
                        responsesHtml += '</div>';
                        responsesHtml += `</div>`;
                    });
                    responsesHtml += `</div>`;
                } else {
                    // 只有一个协议，直接折叠所有状态码
                    const protocol = protocols[0];
                    const statusEntries = Object.entries(api.responses[protocol]);
                    responsesHtml += '<div class="accordion response-accordion">';
                    statusEntries.forEach(([status, details], idx) => {
                        const defaultOpen = idx === 0 ? 'open' : '';
                        responsesHtml += `
                            <details class="response-status-accordion" ${defaultOpen}>
                                <summary style="font-weight:600; font-size:1.1em; cursor:pointer;">
                                    <span class="status-code status-${status}" style="margin-right:8px;">${status}</span>
                                    <span>${details.description || ''}</span>
                                    <span class="accordion-arrow"><svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 3l6 5-6 5" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                                </summary>
                                <div class="response-example" style="margin-top:1rem; border-top: 1px solid hsl(var(--border)); padding-top: 1rem;">
                                    <div class="code-block">
                                        <pre><code class="language-json">${details.example}</code></pre>
                                    </div>
                                </div>
                            </details>
                        `;
                    });
                    responsesHtml += '</div>';
                }
                responsesHtml += `</div>`;
            }

            let codeSamplesHtml = '';
            if (api.codeSamples) {
                codeSamplesHtml = `
                    <div class="section">
                        <h3>代码示例</h3>
                        <div class="tabs" data-api-id="${api.id}">
                            <div class="tab-list">
                                ${Object.keys(api.codeSamples).map((lang, index) =>
                    `<button class="tab-button ${index === 0 ? 'active' : ''}" data-tab="code-${api.id}-${lang}">${lang.charAt(0).toUpperCase() + lang.slice(1)}</button>`
                ).join('')}
                            </div>
                            ${Object.entries(api.codeSamples).map(([lang, frameworks], index) => {
                                const frameworkEntries = Object.entries(frameworks);
                                const firstFramework = frameworkEntries[0];
                                return `
                                    <div class="tab-content ${index === 0 ? 'active' : ''}" data-tab="code-${api.id}-${lang}">
                                        <div class="framework-dropdown">
                                            <select id="framework-${api.id}-${lang}" data-api-id="${api.id}" data-lang="${lang}">
                                                ${frameworkEntries.map(([framework, code]) => 
                                                    `<option value="${framework}" ${framework === firstFramework[0] ? 'selected' : ''}>${framework.charAt(0).toUpperCase() + framework.slice(1)}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                        <div class="code-container">
                                            <button class="copy-button" data-code="${api.id}-${lang}-${firstFramework[0]}">复制</button>
                                            <div class="code-block">
                                                <pre><code class="language-${lang === 'curl' ? 'bash' : lang}" id="code-${api.id}-${lang}-${firstFramework[0]}">${firstFramework[1]}</code></pre>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            doc.innerHTML = `
                <h2>
                    <span class="method-badge method-${api.method.toLowerCase()}">${api.method}</span>
                    <span class="api-summary">${api.summary}</span>
                    <code class="api-path">${api.path}</code>
                </h2>
                <p class="description">${api.description}</p>
                ${parametersHtml}
                ${responsesHtml}
                ${codeSamplesHtml}
            `;

            return doc;
        }

        function createParameterTable(title, parameters) {
            return `
                <div class="section">
                    <h3>${title}</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>参数名</th>
                                <th>类型</th>
                                <th>必需</th>
                                <th>示例值</th>
                                <th>描述</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${parameters.map(param => `
                                <tr>
                                    <td><code>${param.name}</code></td>
                                    <td>${param.type}</td>
                                    <td>${param.required ? '是' : '否'}</td>
                                    <td>${param.value||''}</td>
                                    <td>${param.description}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function showApiDoc(apiId) {
            // Update sidebar active state
            document.querySelectorAll('.api-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-api-id="${apiId}"]`).classList.add('active');

            // Update content active state
            document.querySelectorAll('.api-doc').forEach(doc => {
                doc.classList.remove('active');
            });
            document.getElementById(`doc-${apiId}`).classList.add('active');

            // Update URL hash
            window.location.hash = apiId;

            // Highlight code
            setTimeout(() => {
                hljs.highlightAll();
            }, 100);
        }

        // Tab click handler function
        function handleTabClick(e) {
            const tabName = e.target.dataset.tab;
            const tabContainer = e.target.closest('.tabs');

            if (!tabContainer) return;

            // Update tab buttons
            tabContainer.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');

            // Update tab content
            tabContainer.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Find the target content by matching the data-tab attribute
            const targetContent = tabContainer.querySelector(`.tab-content[data-tab="${tabName}"]`);
            
            if (targetContent) {
                targetContent.classList.add('active');
                
                // Re-highlight code in the active tab
                setTimeout(() => {
                    const codeBlocks = targetContent.querySelectorAll('pre code');
                    codeBlocks.forEach(block => {
                        hljs.highlightElement(block);
                    });
                }, 50);
            }
        }

        // Global event delegation for tab switching
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab-button')) {
                e.preventDefault();
                handleTabClick(e);
            }
            
            // Handle copy button clicks
            if (e.target.classList.contains('copy-button')) {
                e.preventDefault();
                handleCopyClick(e);
            }
        });

        // Handle framework dropdown changes
        document.addEventListener('change', function(e) {
            if (e.target.matches('select[id^="framework-"]')) {
                handleFrameworkChange(e);
            }
        });

        // Framework change handler
        function handleFrameworkChange(e) {
            const select = e.target;
            const apiId = select.dataset.apiId;
            const lang = select.dataset.lang;
            const selectedFramework = select.value;
            
            const api = apiDefinitions.find(api => api.id === apiId);
            if (!api || !api.codeSamples || !api.codeSamples[lang]) {
                return;
            }
            
            const code = api.codeSamples[lang][selectedFramework];
            if (typeof code === 'undefined') {
                return;
            }

            const codeBlock = select.closest('.tab-content').querySelector('.code-block pre code');
            if (codeBlock) {
                // 1. 移除 class 和 highlight.js 添加的 data-* 属性
                codeBlock.className = '';
                codeBlock.removeAttribute('data-highlighted');

                // 2. 设置语言 class
                const languageClass = lang === 'curl' ? 'language-bash' : `language-${lang}`;
                codeBlock.classList.add(languageClass);
                
                // 3. 设置代码内容
                codeBlock.textContent = code;
                
                // 4. 重新高亮
                hljs.highlightElement(codeBlock);
            }
            
            // Update copy button data attribute
            const copyButton = select.closest('.tab-content').querySelector('.copy-button');
            if (copyButton) {
                copyButton.dataset.code = `${apiId}-${lang}-${selectedFramework}`;
            }
        }

        // Copy button handler
        function handleCopyClick(e) {
            const button = e.target;
            const codeId = button.dataset.code;
            const codeElement = document.getElementById(`code-${codeId}`);
            
            if (codeElement) {
                const textToCopy = codeElement.textContent;
                
                // Use the Clipboard API if available
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showCopySuccess(button);
                    }).catch(() => {
                        fallbackCopyTextToClipboard(textToCopy, button);
                    });
                } else {
                    fallbackCopyTextToClipboard(textToCopy, button);
                }
            }
        }

        // Fallback copy method for older browsers
        function fallbackCopyTextToClipboard(text, button) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess(button);
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textArea);
        }

        // Show copy success feedback
        function showCopySuccess(button) {
            const originalText = button.textContent;
            button.textContent = '已复制!';
            button.classList.add('copied');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
            }, 2000);
        }

        // Navigation
        document.addEventListener('click', function (e) {
            if (e.target.matches('a[href="/"]')) {
                e.preventDefault();
                window.location.href = '/index.html';
            } else if (e.target.matches('a[href="/test"]')) {
                e.preventDefault();
                window.location.href = '/test.html';
            }
        });

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', loadApiConfig);

        // 新增：协议切换事件监听
        document.addEventListener('change', function(e) {
            if (e.target.matches('select[id^="protocol-select-"]')) {
                const select = e.target;
                const apiId = select.dataset.apiId;
                const status = select.dataset.status;
                const protocol = select.value;
                // 找到当前api
                const api = apiDefinitions.find(api => api.id === apiId);
                if (!api || !api.responses || !api.responses[status] || !api.responses[status][protocol]) return;
                // 更新描述
                const descElem = select.closest('.response-example').querySelector('.protocol-desc');
                descElem.textContent = api.responses[status][protocol].description || '';
                // 更新代码
                const codeElem = document.getElementById(`response-code-${apiId}-${status}`);
                codeElem.textContent = api.responses[status][protocol].example || '';
                // 重新高亮
                hljs.highlightElement(codeElem);
            }
        });
    </script>
</body>

</html>